# 概要
<!-- このチケットで解決したい課題 -->
DOM書き換えに成功すると、サイトのもともとのスタイルやスクリプトが保持されなくなる問題を解決する

## 背景
機能が出来上がってきたため、いくつかのサイトで動作確認を行ったところ、DOM書き換え後にスタイルやスクリプトが失われてしまうケースが見つかった。 例えば、動的に生成されるコンテンツや、特定のCSSフレームワークを使用しているサイトで問題が発生している。
- サイトA: もともと画像がモーダル表示されるが、DOM書き換え後に通常のリンクとして表示されるようになった
- サイトB: ボタンのスタイルが失われ、デフォルトのブラウザースタイルで表示されるようになった


## 根拠はないが、ぼんやり考えていること
- HtmlReplacerで、rootElement.innerHTMLで全体を書き換えているため、その一瞬の間に動的なレンダリング(lazyload等)があると、齟齬が生じるのではないか
- 一番いいのは、`置換前`に一致するDOMの差分だけを書き換えるようにしたい。全体を取得して一部を書き換えて戻すという方法は齟齬が生じうるのでやめたい。
- それが難しければ、lazyload等の動的レンダリングが完了した後に、HtmlReplacerを実行するようにしたい。
  - できれば、静的/動的レンダリングの完了を検知してからHtmlReplacerを実行したい。
  - ほかの拡張機能はそうしてるっぽい(uAutoPagerize等)。
- それも難しければ、タブのcompleteイベントの5秒後とか10秒後にHtmlReplacerを実行するようにしたい。
- ただそれ以外に最善策があれば、上記にはこだわらない。


## 関連リンク

# 受け入れ条件
<!-- チケットをクローズできる条件を状態として表現する -->

# 心配事
<!-- チケットを進めるうえでハードルとなりそうな懸念点を列挙します -->

# 制限事項
<!-- チケットを進めるうえでの制限事項を列挙します -->

# タスク
<!-- チケットの見積もりを行うために、必要なタスクを列挙します -->