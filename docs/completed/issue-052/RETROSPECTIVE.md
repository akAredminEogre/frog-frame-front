# 振り返り

このファイルでデイリースクラムの振り返りを行います。追記専用です。過去の内容を修正しないでください。

## スクラム01 の振り返り
<!-- KPT法で振り返りを行なってください -->

### Keep
<!-- うまく行ったこと、続けていきたいこと -->

- 正規表現によるDOM置換機能の実装に成功した
- unitテストを全6項目作成して全て成功させることができた
- 非キャプチャグループ`(?:\s*)`を使用することで、ユーザーのキャプチャグループ番号を保護する実装ができた
- HtmlContent.tsの完全な書き直しを行い、シンプルで確実に動作する実装にできた
- 正規表現でも改行無視のロジックを適用しつつ、ユーザーの意図したパターンを崩さない実装ができた

### Problem
<!-- 問題点、苦労したこと、レビューで指摘を受けたこと -->

- 最初の正規表現エスケープ実装で何度もエラーが発生し、実装に時間がかかった
- `(?:\\\\\\\\s*)`のような複雑なエスケープで混乱し、正規表現の理解不足が露呈した
- E2Eテストで2つのaタグが見つかる問題が残り、完全な解決には至らなかった
- 置換処理が複数回実行される原因の特定ができなかった
- Playwrightブラウザのインストールが必要だったが事前に気づけなかった

### Try
<!-- 次回やってみたいこと -->
<!-- タスクベースではなく、行動ルールとして記載してください。 -->

- 正規表現を扱う実装では、最初に小さなテストケースで動作確認してから本実装に取り掛かる
- エスケープが複雑になる場合は、段階的に実装して各段階で動作確認を行う
- E2Eテストで問題が発生した場合は、まずunitテストで機能の動作を確認してから原因を特定する
- 必要なツールや依存関係は事前に調査して準備しておく
- 複雑な置換ロジックでは、デバッグ用のログ出力を仕込んで問題箇所を特定しやすくする

---

## スクラム02 の振り返り

### Keep
<!-- うまく行ったこと、続けていきたいこと -->

- **ログ分析による根本原因特定**: タイムスタンプ付きログを活用することで、3つの実行トリガーを正確に特定できた
- **段階的な問題解決アプローチ**: まずE2Eテストの基本問題を解決し、その後により深い根本原因を分析する段階的アプローチが効果的だった
- **シンプルな解決策の優先**: 複雑なデバウンス機能を実装する代わりに、不要な実行トリガーを除去するシンプルな解決策を選択できた
- **テスト駆動による検証**: E2Eテストを指標として修正の効果を確認し続けることで、確実な問題解決ができた
- **詳細な作業記録**: PROGRESS-02.mdに2回目と3回目の作業を詳細に記録し、後から振り返りができるようにした

### Problem
<!-- 問題点、苦労したこと、レビューで指摘を受けたこと -->

- **複数aタグ問題の原因特定に時間がかかった**: 最初はテスト側の問題と考えていたが、実際はアプリケーション側の複数実行が原因だった
- **実行フローの全体像把握不足**: 当初は個別の問題として捉えていたが、実行トリガーの全体的な流れを把握するのに時間を要した
- **デバウンス機能の過剰実装**: 問題の本質を理解する前に複雑な対症療法（デバウンス）を実装してしまった
- **HandleStorageChangedUseCaseの役割理解不足**: このUseCaseが実際にはapplyAllRulesを重複実行していることに気づくのが遅れた

### Try
<!-- 次回やってみたいこと -->
<!-- タスクベースではなく、行動ルールとして記載してください。 -->

- **問題発生時は最初に実行フロー全体を把握する**: 個別の現象に対処する前に、システム全体の動作フローを理解してから原因を探る
- **複雑な対症療法より根本原因の除去を優先する**: 問題の症状を抑える複雑な仕組みを作る前に、問題の根本原因を除去できないかを検討する
- **ログ分析による問題特定手法を標準化する**: タイムスタンプ付きログを活用した今回の分析手法を、他の問題解決にも積極的に活用する
- **UseCaseの役割と責任範囲を明確にする**: 各UseCaseが何を担当し、どんな副作用を持つのかを実装時点で明確にしておく

---

## スクラム03 の振り返り

### Keep
<!-- うまく行ったこと、続けていきたいこと -->

- **継続的なリファクタリングによる設計改善**: 12回のレビューサイクルを通じて、段階的に設計を改善し続けることができた
- **Strategyパターンの効果的な導入**: if句を除去し、将来の拡張に対応できる柔軟な設計を実現できた
- **テストコーディング標準への完全準拠**: 配列ベースのテスト実装とJSDoc記述原則に従った保守性の高いテストコードを作成できた
- **リフレクションテストの活用**: プライベートメソッドの品質保証を実現し、テストカバレッジを向上させることができた
- **レビューコメントへの迅速な対応**: 各レビュー指摘に対して適切な修正を行い、より良い設計に改善できた
- **コーディング標準の徹底**: else句の早期リターン化、重複処理の共通化など、一貫したコーディング標準を維持できた

### Problem
<!-- 問題点、苦労したこと、レビューで指摘を受けたこと -->

- **過度な責任分離による複雑化**: 最初のPattern/PatternProcessor分離は過剰で、レビューで統合を指摘された
- **設計の方向性で迷いが発生**: PatternとPatternProcessorの分離是非、HtmlWhitespacePatternProcessorの必要性など、設計判断で迷うことが多かった
- **プライベートメソッドテストの課題**: addHtmlWhitespaceIgnoringPatternのテスト方法で、静的メソッド化→リフレクションと方針が変更された
- **重複処理の識別の遅れ**: HTML要素間改行コード処理の重複に対する対応が後手に回った
- **テストファイル細分化の基準理解不足**: テストコーディング標準への準拠に時間を要した

### Try
<!-- 次回やってみたいこと -->
<!-- タスクベースではなく、行動ルールとして記載してください。 -->

- **設計判断時は複雑さとメリットのバランスを重視する**: 分離や抽象化を行う際は、その複雑さに見合う明確なメリットがあるかを事前に検討する
- **レビュー前に設計の妥当性を自己評価する**: コードレビューに出す前に、責任分離が適切か、過度に複雑になっていないかを自分で確認する
- **テストコーディング標準を実装開始時に確認する**: テストファイル作成時に標準を再確認し、最初から準拠した形で実装する
- **重複処理は発見次第即座に共通化する**: コードレビューで指摘される前に、重複パターンを積極的に発見して共通化する
- **プライベートメソッドのテスト戦略を事前に決める**: プライベートメソッドを作成する際は、テスト方法も同時に検討して一貫した方針で実装する

---

## スクラム04 の振り返り

### Keep
<!-- うまく行ったこと、続けていきたいこと -->

- **regex関係の定数クラス作成の完了**: 正規表現パターンとマジックナンバーを適切に定数化し、保守性と可読性を大幅に向上させることができた
- **包括的なテストケース作成**: RegexConstants.tsの全定数に対して包括的な単体テストを作成し、品質を確保できた
- **全品質チェックの通過**: 全単体テスト（209テスト）、全E2Eテスト（6テスト）、リンターとknipのチェックが全て通過し、高品質な実装を完成させた
- **issue-052の完全達成**: 計画されていた全てのタスクを完了し、プロジェクトを完成に導くことができた
- **適切な定数粒度の実現**: 正規表現特殊文字エスケープ、HTML要素間改行コード無視処理、正規表現フラグなど、適切な粒度で定数化を実現できた

### Problem
<!-- 問題点、苦労したこと、レビューで指摘を受けたこと -->

- **RewriteRuleの実装方針でレビュー指摘**: 正規表現関連の定数を直接利用していたが、メンバ変数として呼び出してから利用する形への修正が必要と指摘された
- **クラス設計の一貫性不足**: 定数クラスを利用する際の設計パターンについて、事前に十分検討できていなかった
- **レビューコメントの対応が次回スクラムに持ち越し**: スクラム04内でレビューコメントの対応まで完了できなかった

### Try
<!-- 次回やってみたいこと -->
<!-- タスクベースではなく、行動ルールとして記載してください。 -->

- **定数クラス利用時のクラス設計パターンを統一する**: 定数を利用する際は、直接アクセスではなくメンバ変数経由でのアクセスパターンを標準とする
- **レビュー前にクラス設計の一貫性を確認する**: 定数クラスや外部クラスを利用する際は、クラス設計の一貫性と責任分離の観点から実装方針を事前に検討する
- **スクラム内でのレビュー対応完了を目指す**: レビューコメントが発生した場合は、可能な限り同一スクラム内で対応を完了させる
- **定数化の設計指針を明文化する**: 今回の実装経験を基に、定数クラスの設計と利用に関する指針を整理して今後の開発に活用する

---

## スクラム05 の振り返り

### Keep
<!-- うまく行ったこと、続けていきたいこと -->

- **ファイル構造リファクタリングの完全実施**: RewriteRule関連ファイルを適切なディレクトリ構造に移動し、38ファイルのimport文修正を確実に完了できた
- **テストコーディング標準への完全準拠**: `.clinerules/03-testing-standards`に従った配列ベーステストの実装と、JSDocコメントの適切な記述を実現できた
- **テストファイルの論理的分割**: HtmlContent.test.tsとcreateRedundantPattern.test.tsを機能別に分割し、保守性の高いテスト構造を構築できた
- **レビューコメントへの迅速対応**: 7回のレビューサイクルを通じて、各指摘事項に対して適切かつ迅速に対応し続けることができた
- **コード品質向上の継続実施**: 繰り返し使用されるHTML文字列の定数化など、小さな改善も継続的に実施できた
- **RewriteRuleコンストラクタパラメータの統一**: テストデータ構造をコンストラクタに準拠した形に統一し、一貫性のあるテストコードを実現できた

### Problem
<!-- 問題点、苦労したこと、レビューで指摘を受けたこと -->

- **7回のレビューサイクルが必要**: PRレビュー指摘事項への対応が予想以上に多段階にわたり、効率的でなかった
- **テストコーディング標準の理解不足**: 配列ベーステストの実装方法、JSDocコメントの記述方式、assertionTypeの統一などで複数回の修正が必要だった
- **ファイル分割の基準判断**: HtmlContent.test.tsの分割方針（正規表現パターンと文字列パターン）の理解に時間を要した
- **RewriteRuleコンストラクタパラメータ理解の遅れ**: searchPattern/replacePatterからoldString/newStringへの変更で混乱が生じた
- **細かい定数化指摘の対応**: HTML文字列の定数化が段階的に指摘され、一度に完了できなかった

### Try
<!-- 次回やってみたいこと -->
<!-- タスクベースではなく、行動ルールとして記載してください。 -->

- **実装開始前にテストコーディング標準を徹底確認する**: テストファイル作成時は事前に.clinerules/03-testing-standardsを確認し、最初から準拠した形で実装する
- **ファイル移動時は影響範囲を事前に完全把握する**: import文修正が必要なファイルを事前にリストアップし、漏れなく対応する計画を立てる
- **レビュー前にコーディング標準への準拠を自己点検する**: PRレビュー前に、繰り返し文字列の定数化、命名規則、構造統一などを自分で確認する
- **テストデータ構造は実装クラスに完全準拠させる**: テストデータを作成する際は、対象クラスのコンストラクタやメソッドのパラメータに完全に合わせた構造にする
- **類似修正は一括で完了させる**: HTML文字列定数化のような類似性のある修正は、一度に全箇所を対応して修正回数を最小化する

---
