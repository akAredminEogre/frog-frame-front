# ISSUE-091 PULL REQUEST テンプレート

## タイトル
E2Eテストのローカライゼーション：外部依存を排除してテストの安定性と実行速度を向上

## 概要と理由
E2Eテスト `replace-inside-dom-with-regex.spec.ts` が外部Webページに依存しており、テストの不安定性（flaky）と実行速度の遅さが課題となっていました。この問題を解決するため、外部依存を排除してローカルHTMLファイルを使用するようにリファクタリングしました。

**解決した課題：**
- 外部Webサイトの変更や不安定性によるテスト失敗
- ネットワーク依存による実行速度の低下
- テスト環境の制御性の不足

## 主な変更点

### 1. ローカルHTMLファイルの作成
- `tests/e2e/fixtures/book-page.html`を新規作成
- 必要なHTMLタグ構造（ISBN情報）を含む最小限のテストページを提供

### 2. E2Eテストの修正
- `replace-inside-dom-with-regex.spec.ts`を外部URLからローカルHTMLファイル参照に変更
- テストロジックと期待値は維持したまま、データソースのみを変更

### 3. Chrome拡張機能の修正
- `matchUrl.ts`でChrome拡張機能のマッチパターンエラーを修正
- ポート番号を含むURLパターンの除去
- 無効なマッチパターンの適切な形式への変更

### 4. ドキュメント整備
- テストコードとHTMLファイルにローカライゼーションの目的を説明するコメントを追加
- デバッグログのクリーンアップを実施

## テスト方法
[動作確認の手順]
- `docker compose exec frontend npm run test-and-lint` で回帰テスト通過・未使用コードがないことを確認
  - 既存自動テストとlinterを同時に確認
  - ユニットテスト: 72ファイル、263テストがすべて成功
  - E2Eテスト: 9テストがすべて成功（複数回実行で安定性確認済み）
  - lint、knip、tsrのチェックもすべてクリア

## 補足
[追加の文脈や注意点]
- テストの実行時間が大幅に改善されました
- 外部依存排除により、CI/CDパイプラインでの安定性が向上します
- ローカルHTMLファイルは必要最小限の構造で作成し、保守性を考慮しています
- Chrome拡張機能の仕様制約についても同時に解決しました

## 本スコープの対象外となったタスク
特になし。計画されたすべてのタスクを完了しました。

<!-- ユーザーが使うコマンド workflow:submit-pull-request -->