# 概要
issue-005: 右クリックメニュー「この要素を置換」機能の追加

# 変更点
Webページ上でのテキスト置換のUXを改善するため、新しい右クリックメニュー機能を実装しました。
従来の「この部分を置換」機能を「この要素を置換」に置き換え、選択したテキストを含む要素全体を置換対象にできるようになりました。

## 主な実装内容

### 1. 右クリックメニューの実装
- `background.ts`に新しいコンテキストメニューアイテム「この要素を置換」を追加
- メニューID: `context-menu-replace-dom-element`
- 従来の「この部分を置換」機能を新機能に置き換え

### 2. 要素選択ロジックの実装
- `content.ts`に`getElementSelectionInfo()`関数を追加
- `window.getSelection()`を使用した選択範囲の取得
- `commonAncestorContainer`による共通祖先要素の特定
- テキストノードの場合は親要素を取得するロジック
- 対象要素の`outerHTML`を返す処理

### 3. メッセージ通信の実装
- 新しいメッセージタイプ`getElementSelection`を追加
- background.tsとcontent.ts間の通信を適切に処理
- 既存の`getSelection`処理と区別して実装
- エラーハンドリングを含む堅牢な実装

### 4. テストの実装と検証
- 関連するテストコードの更新（menuItemIdとmessageTypeの整合性確保）
- 手動テストによる動作検証
- 全91個のテストが正常に通過することを確認

## ユーザーストーリーの実現
以下のユーザーストーリーが実現されました：

1. ユーザーがWebページ上でテキストを選択
2. 右クリックメニューから「この要素を置換」を選択
3. 選択したテキストを含む最小のHTML要素全体がポップアップの「置換前」フィールドに反映

例：「顧客満足を最優先」を選択した場合、
```html
<p><font size="+2">
顧客満足を最優先し、<br>価値のあるソフトウェアを早く継続的に提供します。
</font></p>
```
この要素全体が置換前に設定されます。

## 技術的な改善点
- 選択されたテキストを含む最小のHTML要素を正確に特定するアルゴリズムの実装
- 複数要素にまたがる選択やネストした要素での適切な動作
- メッセージ通信の型安全性とエラーハンドリングの向上

## テスト結果
- 単体テスト: 全91個のテストが通過
- 手動テスト: 様々なHTML構造での動作を検証済み
- ユーザーストーリーのシナリオテスト: 正常動作を確認

この実装により、ユーザーはより直感的で効率的なテキスト置換が可能になり、UXが大幅に改善されました。
