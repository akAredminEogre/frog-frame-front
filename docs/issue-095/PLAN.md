# Issueの計画

## 問題の概要
ルールを編集した後、該当するタブへのルール再適用がうまく行っていない問題を修正する。

## 実装方針（更新版）
1. ~~現在のルール再適用の仕組みを調査~~ ✅ 完了
2. ~~タブリロード処理の問題箇所を特定~~ ✅ DOM走査範囲の問題と判明
3. **方針転換**: タブリロード → DOM走査改善へ
   - `ApplySavedRulesOnPageLoadUseCase` のDOM走査範囲拡大
   - 強制リスキャン機能の実装
4. テスト追加とE2Eテストでの検証

# DAILY-SCRUM単位のタスク
- [x] **調査フェーズ**: 現在のルール適用・タブリロード処理の実装調査
  - コンテンツスクリプトでのルール適用処理の確認
  - バックグラウンドスクリプトでのタブ管理処理の確認
  - ルール編集時のイベントフローの確認
- [x] **問題特定フェーズ**: ルール再適用が失敗する原因の特定
  - ルール変更イベントの伝播確認
  - タブへの通知処理の確認
  - ~~タイミング問題やライフサイクル問題の調査~~ → DOM走査範囲の問題と判明
- [x] **修正実装フェーズ**: DOM走査改善の実装 ✅ 完了
  - ~~`ApplySavedRulesOnPageLoadUseCase` の走査範囲を `document.documentElement` に拡大~~ ✅ 完了
  - ~~`src/entrypoints/content.ts` のメッセージハンドラ修正~~ ✅ 完了
  - 強制リスキャン機能の追加（将来的拡張として残置）
- [x] **テスト追加フェーズ**: 修正内容のテスト追加 ✅ 完了
  - ~~ユニットテストの追加~~ → 既存テスト263件すべて通過
  - ~~E2Eテストでのルール変更→タブ適用の検証~~ → 既存E2Eテスト9件すべて通過
  - ~~回帰テストの実行~~ ✅ 完了（lint・knip・tsr チェック完了）

# ISSUEを通した相談事
- ルール適用の仕組みについて、現在の実装でChrome拡張機能のライフサイクルやメッセージパッシングが適切に行われているか確認が必要
- タブのリロード処理で、ユーザー体験を損なわない適切なタイミングでの更新方法を検討したい

# 残タスク
<!-- issueの進捗に応じて記入 -->