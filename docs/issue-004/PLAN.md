# 実装計画

## 1. 概要
`issue-004` の対応として、正規表現を利用したDOM置換機能を実装する。
ユーザーがHTMLタグをエスケープせずに自然に記述できるUXを目指す。

## 2. 実装方針
ユーザーが入力した置換前の文字列を、正規表現が有効な場合はそのまま正規表現パターンとして扱う。
これにより、ユーザーは `<h1>` のようなHTMLタグをエスケープすることなく、`.+` のような正規表現メタ文字と組み合わせて使用できる。
この挙動は、正規表現に慣れているユーザーにとっては直感的である一方、意図しないマッチングを引き起こす可能性もあるため、UI上で注意を促す。

## 3. 主な変更点
- `RewriteRule` に正規表現を有効にするためのフラグを追加する。
- `HtmlContent` の置換ロジックを修正し、正規表現に対応させる。
- UIに正規表現の有効/無効を切り替える機能と、挙動に関する説明を追加する。

## 4. タスク一覧

### 4.1. ドメイン層の修正
- [x] **`RewriteRule.ts` の修正**
  - [x] `RewriteRule` 型に `isRegex?: boolean` プロパティを追加する。
- [x] **`HtmlContent.ts` の修正**
  - [x] `replaceWith` メソッドを修正する。
  - [x] `rule.isRegex` が `true` の場合、`oldString` をエスケープせずにそのまま `new RegExp()` に渡す。これにより、ユーザーが入力した文字列が直接正規表現パターンとして利用される。
  - [x] `rule.isRegex` が `false` の場合は、既存の文字列エスケープ処理を維持する。
- [x] **`HtmlContent.test.ts` の修正**
  - [x] 正規表現置換のテストケースを追加する。
    - [x] `<h1>(.+)</h1>` を `<h2>$1</h2>` に置換するテスト
    - [x] 後方参照 (`$1`) が正しく機能することを確認するテスト
  - [x] 既存の文字列置換テストが影響を受けないことを確認する。

### 4.2. UI層の修正とUXの改善
- [x] **ルール設定画面の変更**
  - [x] 正規表現を利用するかどうかを選択するためのチェックボックスを追加する。
  - [x] チェックボックスの状態を `RewriteRule` の `isRegex` プロパティに反映させる。
- [ ] **ヘルプテキストと注意事項の追加** (別issueで対応)
  - [ ] 正規表現入力欄の近くに、以下の内容を説明するヘルプテキストやツールチップを追加する。
    - [ ] 「正規表現モードでは、入力した文字列がそのまま正規表現パターンとして使用されます。」
    - [ ] 「HTMLタグはエスケープ不要です。例: `<h1>`」
    - [ ] 「後方参照が利用できます。例: `$1`」
    - [ ] 「`.` `+` `*` `()` などの特殊文字は正規表現として解釈されます。」
- [ ] **入力値のバリデーション（推奨）** (別issueで対応)
  - [ ] `isRegex` が `true` の場合、`oldString` が有効な正規表現かどうかの簡易的なバリデーションを実装し、無効な場合はユーザーにフィードバックする。

## 5. 実装ステップ
1. `RewriteRule.ts` を修正する。
2. `HtmlContent.ts` と `HtmlContent.test.ts` を修正し、正規表現置換ロジックを実装・テストする。
3. UI層を修正し、正規表現の有効/無効を切り替えるチェックボックスと、ヘルプテキストを追加する。
4. 全体の動作確認を行う。
