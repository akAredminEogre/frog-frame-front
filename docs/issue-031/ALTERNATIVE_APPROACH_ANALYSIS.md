# 代替アプローチの分析：正規表現変換方式

## 提案内容
```
`<` → `\s*<` に変換
`>` → `>\s*` に変換
```
ユーザー入力の `<h1>アジャイルソフトウェア開発宣言</h1>` を `\s*<h1>\s*アジャイルソフトウェア開発宣言\s*</h1>\s*` に変換して正規表現として使用する方式。

## 問題点の分析

### 1. 特殊文字のエスケープ問題
**問題**: HTMLタグには正規表現の特殊文字が含まれる可能性があり、適切にエスケープされていない。

**具体例**:
```html
<!-- ユーザー入力 -->
<div class="item-[1-9]">

<!-- 変換後（問題あり） -->
\s*<div class="item-[1-9]">\s*

<!-- 期待される変換 -->
\s*<div class="item-\[1-9\]">\s*
```

**影響**: `[1-9]` が文字クラスとして解釈され、意図しないマッチが発生。

### 2. タグ内空白への対応不足
**問題**: タグの開始と終了の前後の空白のみ対応し、タグ内の空白には対応できない。

**具体例**:
```html
<!-- 元のHTML -->
<h1 class="title">アジャイルソフトウェア開発宣言</h1>

<!-- ユーザー入力 -->
<h1>アジャイルソフトウェア開発宣言</h1>

<!-- 変換後 -->
\s*<h1>\s*アジャイルソフトウェア開発宣言\s*</h1>\s*
```

**影響**: 属性を持つタグとマッチしない。

### 3. 過度なマッチングリスク
**問題**: `\s*` は任意の数の空白文字にマッチするため、意図しない範囲までマッチしてしまう。

**具体例**:
```html
<!-- 元のHTML -->
<div>
  <h1>アジャイルソフトウェア開発宣言</h1>
  <p>テキスト</p>
</div>

<!-- 変換されたパターン -->
\s*<h1>\s*アジャイルソフトウェア開発宣言\s*</h1>\s*
```

**影響**: `<h1>` の前の改行・インデントと `</h1>` 後の改行・インデントの間の `<p>テキスト</p>` も含む可能性。

### 4. 置換結果の予測困難性
**問題**: マッチした範囲に含まれる空白の扱いが不明確。

**具体例**:
```html
<!-- 元のHTML -->
  <h1>
    アジャイルソフトウェア開発宣言
  </h1>

<!-- 置換後に期待される結果は？ -->
  <h2>アジャイルソフトウェア開発宣言</h2>  <!-- パターン1: 空白保持 -->
<h2>アジャイルソフトウェア開発宣言</h2>    <!-- パターン2: 空白除去 -->
```

### 5. 複雑なHTMLタグへの対応限界
**問題**: 自己終了タグ、複数属性、ネストしたタグなどに対応できない。

**具体例**:
```html
<!-- 自己終了タグ -->
<img src="logo.png" />  <!-- `>` が最後にない -->

<!-- 複数属性 -->
<div class="container" id="main" data-role="header">

<!-- ネストしたタグ -->
<div><span class="highlight">重要</span>なテキスト</div>
```

## 推奨される解決策

### 元の提案（NormalizedString方式）の優位性
1. **確実性**: 空白を完全除去することで確実にマッチング
2. **予測可能性**: 置換結果が明確
3. **柔軟性**: あらゆる種類のHTMLタグに対応
4. **保守性**: ロジックが単純で理解しやすい

### 改良案：ハイブリッドアプローチ
もしパフォーマンスが気になる場合の代替案：

```typescript
// 段階的マッチング
1. 単純な文字列マッチを試行
2. 失敗した場合のみNormalizedStringによるマッチを実行
3. 最も軽い処理で済む場合が多くなる
```

## 結論
正規表現変換方式は実装が簡単に見えますが、HTMLの複雑性を考慮すると多くの問題を抱えています。NormalizedString方式の方が確実で保守性が高い解決策といえます。
